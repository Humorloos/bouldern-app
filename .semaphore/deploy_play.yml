version: v1.0
name: Deploy app to playstore internal track
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
  containers:
    - name: main
      image: 'registry.semaphoreci.com/android:29'

global_job_config:
  secrets:
    - name: gpp-key
    - name: release-keystore
  prologue:
    commands:
      - checkout
      - PROJECT_DIR=/home/semaphore/"$SEMAPHORE_GIT_DIR"
      - FRONTEND_DIR="$PROJECT_DIR"/frontend
      - ANDROID_APP_DIR="$FRONTEND_DIR"/android/app
      - mv ~/release-keystore.jks "$ANDROID_APP_DIR"/release-keystore.jks
      - mv ~/gpp-key.json "$ANDROID_APP_DIR"/gpp-key.json
      - cd "$FRONTEND_DIR"/android
      - . /home/semaphore/.env
      - sem-version java 11
blocks:
  - name: Deploy app to playstore internal track
    task:
      jobs:
        - name: Deploy app to playstore internal track
          commands:
            - . gradlew publishReleaseBundle --track internal --release-status draft
